<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dilemma Spel</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Landing Screen -->
        <div id="landing-screen" class="screen active">
            <h1>DILEMMA</h1>
            
            <div class="name-container">
                <input type="text" id="username-input" placeholder="JOUW NAAM" maxlength="12">
            </div>

            <p class="landing-text">Maak of join een party</p>
            <div class="actions">
                <button id="create-init-btn" class="btn primary">Maak Party</button>
                <div class="divider">OF</div>
                <div class="join-container">
                    <input type="text" id="room-code-input" placeholder="CODE" maxlength="6">
                    <button id="join-btn" class="btn secondary">Join</button>
                </div>
            </div>
            
            <button id="changelog-btn" class="btn small" style="margin-top: 20px; background: var(--secondary); color: var(--text); padding: 10px 20px; font-size: 0.9rem;">ðŸ“‹ Changelog</button>
        </div>

        <!-- Changelog Modal -->
        <div id="changelog-modal" class="modal">
            <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
                <h3>ðŸ“‹ Changelog</h3>
                <div id="changelog-content" style="text-align: left; margin-top: 20px;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px;">Versie 2.0 - Huidige Update</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;">âœ… Verbeterde vraag display: toont nu "(Naam) Koos: (optie) omdat: (reden)"</li>
                            <li style="margin-bottom: 8px;">âœ… Meerderheid wordt nu bovenaan getoond</li>
                            <li style="margin-bottom: 8px;">âœ… Vote de Persoon: live typing updates voor alle spelers</li>
                            <li style="margin-bottom: 8px;">âœ… Speciale ronde (rare round) verbeteringen</li>
                            <li style="margin-bottom: 8px;">âœ… AI Anti-Scheldwoorden modus toegevoegd (experimenteel, ll7m.io)</li>
                            <li style="margin-bottom: 8px;">âœ… Willekeurige beurtvolgorde optie</li>
                            <li style="margin-bottom: 8px;">âœ… Lobby timeout verwijderd - lobby blijft voor altijd actief</li>
                            <li style="margin-bottom: 8px;">âœ… Crop modal verbeteringen voor mobile</li>
                            <li style="margin-bottom: 8px;">âœ… Foto selectie toont vierkant naast elkaar</li>
                        </ul>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--accent); margin-bottom: 10px;">Versie 1.0 - Laatste Fixes</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;">âœ… Bug fixes voor rare rounds</li>
                            <li style="margin-bottom: 8px;">âœ… Max rondes fix</li>
                            <li style="margin-bottom: 8px;">âœ… Polish verbeteringen</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="changelog-close-btn" class="btn primary">Sluiten</button>
                </div>
            </div>
        </div>

        <!-- Create Settings Screen -->
        <div id="settings-screen" class="screen">
            <div class="header">
                <button id="back-settings-btn" class="btn small icon-btn"><i class="fas fa-arrow-left"></i></button>
                <h2>Party Settings</h2>
            </div>
            
            <div class="settings-content">
                <div class="setting-group">
                    <label>Aantal Spelers</label>
                    <div class="number-selector" id="size-options">
                        <button class="num-btn active" data-value="2">2</button>
                        <button class="num-btn" data-value="3">3</button>
                        <button class="num-btn" data-value="4">4</button>
                        <button class="num-btn" data-value="5">5</button>
                        <button class="num-btn" data-value="6">6</button>
                        <button class="num-btn" data-value="7">7</button>
                        <button class="num-btn" data-value="8">8</button>
                    </div>
                </div>

                <div class="setting-group">
                    <label>Spelmodus</label>
                    <!-- Mode toggles will allow enabling specific modes -->
                    <div class="toggle-options vertical" id="mode-settings-list">
                        <div class="toggle-row">
                            <span>Dilemma's</span>
                            <div class="toggle-switch active" data-mode="dilemma"></div>
                        </div>
                        <div class="toggle-row">
                            <span>Open Vragen</span>
                            <div class="toggle-switch active" data-mode="question"></div>
                        </div>
                        <div class="toggle-row">
                            <span>Foto Modus</span>
                            <div class="toggle-switch" data-mode="photo"></div>
                        </div>
                        <div class="toggle-row">
                            <span>Vote de Persoon</span>
                            <div class="toggle-switch" data-mode="vote-person"></div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label>Tijd om Vraag te Maken</label>
                    <div class="timer-selector">
                        <select id="timer-select" class="timer-select">
                            <option value="0">Oneindig (Standaard)</option>
                            <option value="1">1 minuut</option>
                            <option value="2">2 minuten</option>
                            <option value="3">3 minuten</option>
                            <option value="5">5 minuten</option>
                            <option value="10">10 minuten</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group">
                    <label>Zeldzame Ronde Modus</label>
                    <div class="toggle-row">
                        <span>Zeldzame rondes inschakelen</span>
                        <div class="toggle-switch" id="rare-round-toggle" data-mode="rare-round"></div>
                    </div>
                    <div id="rare-round-settings" style="display: none; margin-top: 10px;">
                        <label style="font-size: 0.9rem; color: #a4b0be;">Zeldzaamheid (elke X vragen):</label>
                        <input type="number" id="rare-round-frequency" min="3" max="20" value="5" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 8px; background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); color: var(--text);">
                    </div>
                </div>

                <div class="setting-group">
                    <label>Beurt Volgorde</label>
                    <div class="toggle-row">
                        <span>Willekeurige volgorde (geen zelfde speler 2x achter elkaar)</span>
                        <div class="toggle-switch" id="random-turn-order-toggle" data-mode="random-turn-order"></div>
                    </div>
                </div>

                <div class="setting-group">
                    <label>AI Anti-Scheldwoorden (Experimenteel)</label>
                    <div class="toggle-row">
                        <span>Activeer AI filtering met ll7m.io API</span>
                        <div class="toggle-switch" id="ai-filter-toggle" data-mode="ai-filter"></div>
                    </div>
                    <div id="ai-filter-settings" style="display: none; margin-top: 10px;">
                        <label style="font-size: 0.9rem; color: #a4b0be;">API Key (llm7.io):</label>
                        <input type="text" id="ai-api-key" placeholder="Voer je llm7.io API key in (token.llm7.io)" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 8px; background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); color: var(--text);">
                        <small style="color: #747d8c; font-size: 0.8rem; display: block; margin-top: 5px;">Experimentele feature - Gebruikt keyword filtering als fallback. Haal gratis token op: <a href="https://token.llm7.io" target="_blank" style="color: var(--accent);">token.llm7.io</a></small>
                    </div>
                </div>
            </div>

            <button id="create-confirm-btn" class="btn primary">Start Lobby</button>
        </div>

        <!-- Waiting Screen -->
        <div id="waiting-screen" class="screen">
            <div class="header waiting-header">
                <div class="room-code-in-header">
                    <div class="code-label-top">KAMER CODE</div>
                    <div class="code-value-hero" id="room-code-display">ABCDEF</div>
                </div>
                <button id="leave-btn" class="btn small icon-btn"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="content centered waiting-content">
                <div class="lobby-status">
                    <div class="loader"></div>
                    <h2 id="waiting-text">Wachten op spelers...</h2>
                    <div id="player-count-indicator" class="count-badge">1 / 2</div>
                </div>
                
                <div id="player-list" class="player-list">
                    <!-- Players will be listed here -->
                </div>
                
                <div class="lobby-settings-display" id="lobby-settings-display">
                    <!-- Settings info will go here -->
                </div>
                
                <button id="host-start-btn" class="btn primary" style="display: none; margin-top: 20px;">Start Nu Spelen</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="header game-header">
                <div class="room-info">
                    <span class="round-badge">Ronde <span id="round-display">1</span></span>
                </div>
                <div class="opponents-info" id="opponents-display">
                    <!-- Names here -->
                </div>
                <button id="leave-game-btn" class="btn small icon-btn"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- Creator Choice View (Select Type) -->
            <div id="creator-choice-view" class="view">
                <h2>Jouw Beurt!</h2>
                <p>Wat wil je maken?</p>
                
                <div id="creator-targets-display" class="target-list">
                    <!-- Will show "Voor: Alex, Tom..." -->
                </div>

                <div class="choice-buttons">
                    <button id="choice-dilemma-btn" class="btn choice-card">
                        <span class="icon"><i class="fas fa-bolt"></i></span>
                        <div class="text">
                            <span>DILEMMA</span>
                            <small>Kies tussen 2 opties</small>
                        </div>
                    </button>
                    <button id="choice-question-btn" class="btn choice-card secondary">
                        <span class="icon"><i class="fas fa-question-circle"></i></span>
                        <div class="text">
                            <span>OPEN VRAAG</span>
                            <small>Typ zelf een antwoord</small>
                        </div>
                    </button>
                    <button id="choice-photo-btn" class="btn choice-card accent">
                        <span class="icon"><i class="fas fa-camera"></i></span>
                        <div class="text">
                            <span>FOTO</span>
                            <small>Kies 2 fotos</small>
                        </div>
                    </button>
                    <button id="choice-vote-person-btn" class="btn choice-card vote-person">
                        <span class="icon"><i class="fas fa-user-check"></i></span>
                        <div class="text">
                            <span>VOTE DE PERSOON</span>
                            <small>Stel een vraag en stem op iemand</small>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Creator Input View -->
            <div id="creator-input-view" class="view">
                <div class="input-header">
                     <button id="back-choice-btn" class="btn small icon-btn"><i class="fas fa-arrow-left"></i></button>
                     <h2 id="input-title">Nieuw Dilemma</h2>
                </div>
                
                <p id="instruction-text">Verzin een lastig dilemma.</p>
                
                <!-- Text Inputs -->
                <div id="text-inputs" class="inputs">
                    <textarea id="option1-input" placeholder="Optie 1..."></textarea>
                    <div class="vs">VS</div>
                    <textarea id="option2-input" placeholder="Optie 2..."></textarea>
                </div>

                <!-- Photo Inputs -->
                <div id="photo-inputs" class="inputs photo-inputs" style="display: none;">
                    <input type="text" id="photo-question-input" placeholder="Stel een vraag (bijv. 'Wie is lekkerder?')" style="width: 100%; margin-bottom: 15px;">
                    <div style="display: flex; flex-direction: row; gap: 10px; width: 100%; align-items: center; justify-content: center; flex-wrap: wrap;">
                        <div class="photo-upload-box" id="photo-upload-1">
                            <input type="file" accept="image/*" id="file-input-1" hidden>
                            <div class="upload-placeholder">
                                <i class="fas fa-plus"></i>
                                <small>Foto 1</small>
                            </div>
                            <img id="preview-1" class="preview-img" hidden>
                            <button class="remove-photo-btn" data-target="1" hidden><i class="fas fa-times"></i></button>
                        </div>
                        <div class="vs-small" style="margin: 0; flex-shrink: 0;">VS</div>
                        <div class="photo-upload-box" id="photo-upload-2">
                            <input type="file" accept="image/*" id="file-input-2" hidden>
                            <div class="upload-placeholder">
                                <i class="fas fa-plus"></i>
                                <small>Foto 2</small>
                            </div>
                            <img id="preview-2" class="preview-img" hidden>
                            <button class="remove-photo-btn" data-target="2" hidden><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Vote Person Input -->
                <div id="vote-person-inputs" class="inputs" style="display: none;">
                    <input type="text" id="vote-person-question-input" placeholder="Stel een vraag (bijv. 'Wie is het liefste?')">
                </div>

                <div class="timer-display-container" id="timer-display-container" style="display: none;">
                    <div class="timer-display">
                        <span id="timer-display-text">Tijd resterend: <span id="timer-value">âˆž</span></span>
                    </div>
                </div>

                <button id="submit-dilemma-btn" class="btn primary">Verstuur</button>
            </div>

            <!-- Voter View: Waiting for Dilemma -->
            <div id="voter-waiting-view" class="view">
                <div class="loader"></div>
                <h2><span id="creator-name-display">De andere</span> maakt iets...</h2>
                <div id="voters-progress-container" class="voters-progress">
                    <!-- Chips of who answered will go here -->
                </div>
            </div>

            <!-- Voter View: Vote -->
            <div id="vote-view" class="view">
                <h2>KIES!</h2>
                <div class="options" id="text-vote-options">
                    <button id="vote-option1" class="btn option-btn">Optie 1</button>
                    <div class="vs-small">VS</div>
                    <button id="vote-option2" class="btn option-btn">Optie 2</button>
                </div>
                
                <div class="options photo-options" id="photo-vote-options" style="display: none;">
                    <div class="photo-option" id="vote-photo-1">
                        <img id="vote-img-1" src="">
                    </div>
                    <div class="vs-small">VS</div>
                    <div class="photo-option" id="vote-photo-2">
                        <img id="vote-img-2" src="">
                    </div>
                </div>
            </div>

            <!-- Voter View: Vote Person -->
            <div id="vote-person-view" class="view">
                <h2 id="vote-person-question-title">Kies een persoon</h2>
                <p style="text-align: center; color: #a4b0be; font-size: 0.9rem; margin-bottom: 15px;">
                    Iedereen kan stemmen, ook de vraagmaker. Je kunt niet op jezelf stemmen.
                </p>
                <div class="vote-person-list-container">
                    <div id="vote-person-list" class="vote-person-list">
                        <!-- Players will be listed here -->
                    </div>
                </div>
            </div>

            <!-- Voter View: Answer Question (Only for Question Mode) -->
            <div id="answer-view" class="view">
                <div class="back-header">
                    <button id="back-vote-btn" class="btn small icon-btn"><i class="fas fa-arrow-left"></i></button>
                    <h2>Antwoord geven</h2>
                </div>
                
                <div class="selected-question-display">
                    <p id="selected-question-text"></p>
                </div>
                <textarea id="answer-input" placeholder="Typ hier je antwoord..."></textarea>
                <button id="submit-answer-btn" class="btn primary">Verstuur Antwoord</button>
            </div>

            <!-- Result View -->
            <div id="result-view" class="view">
                <h2>Resultaat</h2>
                
                <!-- Text Results -->
                <div class="result-box" id="text-results">
                    <div id="result-option1" class="result-card"></div>
                    <div id="result-option2" class="result-card"></div>
                </div>

                <!-- Photo Results -->
                <div class="result-box photo-results" id="photo-results" style="display: none;">
                    <div id="result-photo-1" class="result-card photo-card">
                        <img id="res-img-1" src="">
                        <div class="overlay-stats"></div>
                    </div>
                    <div id="result-photo-2" class="result-card photo-card">
                        <img id="res-img-2" src="">
                        <div class="overlay-stats"></div>
                    </div>
                </div>

                <p id="result-message"></p>
                
                <!-- Answer Display for Question Mode -->
                <div id="answer-display" class="answer-box" style="display: none;">
                    <!-- Content injected by JS -->
                </div>

                <!-- Vote Person Results -->
                <div id="vote-person-results" class="vote-person-results" style="display: none;">
                    <h3 id="vote-person-results-question"></h3>
                    <div id="vote-person-results-list" class="vote-person-results-list">
                        <!-- Results will be shown here -->
                    </div>
                </div>

                <div class="timer-container" id="result-timer-container">
                    <div class="timer-text-display">
                        <span id="timer-text">Volgende ronde over <span id="timer-seconds">0</span>s</span>
                    </div>
                    <div class="timer-bar">
                        <div id="timer-progress" class="timer-progress"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <h3>Stoppen?</h3>
            <p>Je verlaat het huidige spel.</p>
            <div class="modal-actions">
                <button id="confirm-leave" class="btn danger">Stoppen</button>
                <button id="cancel-leave" class="btn secondary">Doorgaan</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal (Custom Alert) -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <h3 id="alert-title">Melding</h3>
            <p id="alert-message">Bericht</p>
            <div class="modal-actions">
                <button id="alert-ok-btn" class="btn primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Crop Modal -->
    <div id="crop-modal" class="modal">
        <div class="modal-content crop-modal-content">
            <h3>Crop Foto</h3>
            <div class="crop-container">
                <canvas id="crop-canvas"></canvas>
                <div class="crop-overlay">
                    <div class="crop-box" id="crop-box">
                        <div class="crop-handle crop-handle-nw"></div>
                        <div class="crop-handle crop-handle-ne"></div>
                        <div class="crop-handle crop-handle-sw"></div>
                        <div class="crop-handle crop-handle-se"></div>
                    </div>
                </div>
            </div>
            <div class="crop-actions">
                <button id="crop-cancel-btn" class="btn secondary">Annuleren</button>
                <button id="crop-confirm-btn" class="btn primary">Bevestigen</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>
